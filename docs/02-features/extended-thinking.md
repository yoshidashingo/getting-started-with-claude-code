# 拡張思考モード

Claude Codeの拡張思考モード（Extended Thinking）は、複雑な問題や設計課題に対して、より深い分析と包括的な解決策を提供する機能です。

## 概要

拡張思考モードでは、Claude Codeが通常よりも時間をかけて問題を分析し、複数の観点から解決策を検討します。これにより、より質の高い、熟考された回答を得ることができます。

## 使用方法

### コマンドラインフラグ

```bash
claude --think "複雑なアーキテクチャ設計について相談したい"
```

### セッション内での有効化

```
/think
次の質問に対して深い分析をお願いします：マイクロサービス間の認証をどう実装すべきか？
```

### 一時的な有効化

特定の質問だけに拡張思考を適用：

```
通常の質問...

/think on
この部分は深く分析してください

/think off
通常モードに戻る
```

## 適用場面

### 1. アーキテクチャ設計

```
/think
現在のモノリシックアプリケーションをマイクロサービスに分割したい。
以下の要件を考慮してください：
- 現在のユーザー数: 10万人
- 将来の拡張性: 100万人まで
- チームサイズ: 開発者15名
- 既存技術: Node.js, PostgreSQL, Redis
```

**拡張思考モードでの分析内容:**
- ドメイン境界の特定
- サービス分割戦略
- データ整合性の確保方法
- 段階的移行計画
- リスクと対策

### 2. パフォーマンス最適化

```
/think
アプリケーションの応答時間が遅い。
現状：
- 平均応答時間: 3秒
- データベースクエリ: 複雑なJOIN多数
- 同時接続数: 1000
最適化戦略を提案してください。
```

**拡張思考モードでの分析内容:**
- ボトルネックの体系的分析
- 複数の最適化アプローチ
- 各アプローチのトレードオフ
- 実装優先順位
- 計測方法の提案

### 3. セキュリティ設計

```
/think
新しい決済システムのセキュリティ設計をレビューしてください。
要件：
- PCI DSS準拠
- 多要素認証
- APIレート制限
- 監査ログ
```

**拡張思考モードでの分析内容:**
- 脅威モデリング
- セキュリティレイヤーの設計
- コンプライアンス要件の確認
- ベストプラクティスとの比較
- 実装チェックリスト

## 拡張思考の特徴

### 1. 多角的分析

通常モード:
```
Q: このエラーの原因は？
A: null参照エラーです。変数をチェックしてください。
```

拡張思考モード:
```
Q: /think このエラーの原因は？
A: このエラーについて分析します：

1. 直接的原因：
   - null参照エラー
   - 発生箇所: user.profile.settings

2. 根本原因の可能性：
   - 非同期処理の競合状態
   - APIレスポンスの不整合
   - エラーハンドリングの欠如

3. 関連する問題：
   - 同様のパターンが他にも存在する可能性
   - テストカバレッジの不足

4. 推奨される対策：
   - Optional chainingの使用
   - 型安全性の強化
   - 防御的プログラミング
```

### 2. 長期的視点

通常モード:
```
Q: この機能をどう実装する？
A: [即座に動作するコード]
```

拡張思考モード:
```
Q: /think この機能をどう実装する？
A: 実装方針を検討します：

短期的実装：
- 最小限の実装で動作確認
- 既存コードへの影響最小化

中期的考慮：
- 拡張性を考慮した設計
- テスト容易性の確保
- ドキュメント化

長期的展望：
- 将来の要件変更への対応
- 技術的負債の最小化
- チーム全体での保守性
```

### 3. トレードオフの明確化

```
/think
キャッシュ戦略を決めたい：
- レスポンス高速化
- データ整合性
- 実装の複雑さ
```

拡張思考での回答：
- 各戦略のメリット・デメリット表
- 具体的な数値での比較
- 段階的導入プラン
- 判断基準の提示

## ベストプラクティス

### 1. 具体的な情報の提供

❌ 曖昧な質問:
```
/think
パフォーマンスを改善したい
```

✅ 具体的な質問:
```
/think
ECサイトの商品検索が遅い：
- 商品数: 100万件
- 検索時間: 5-10秒
- 使用技術: PostgreSQL全文検索
- 同時検索数: 100リクエスト/秒
```

### 2. 制約条件の明示

```
/think
新機能の設計をお願いします。
制約：
- 開発期間: 2週間
- 使用可能技術: 既存スタックのみ
- 下位互換性: 必須
- パフォーマンス: 現状維持以上
```

### 3. 期待する出力の指定

```
/think
分析結果は以下の形式でお願いします：
1. 問題の要約
2. 解決案（3つ以上）
3. 各案の比較表
4. 推奨案とその理由
5. 実装ステップ
```

## 注意事項

### パフォーマンスへの影響

- 通常モードより応答時間が長い
- より多くのコンピューティングリソースを使用
- コスト面での考慮が必要

### 適切な使用場面

推奨される場面:
- アーキテクチャ設計
- 複雑なアルゴリズムの設計
- セキュリティ分析
- 大規模リファクタリング計画

推奨されない場面:
- 単純な構文エラーの修正
- 定型的なコード生成
- 即座の回答が必要な場合

## 組み合わせテクニック

### メモリ機能との併用

```markdown
# CLAUDE.md
## プロジェクト制約
- レガシーシステムとの連携必須
- Java 8の使用（アップグレード不可）
- オンプレミス環境のみ
```

```
/think
これらの制約下で、モダンなマイクロサービスアーキテクチャを実現する方法
```

### 段階的分析

```
/think phase:research
まず、この技術領域の最新トレンドと事例を分析

/think phase:design
収集した情報を基に、具体的な設計案を作成

/think phase:validation
設計案の実現可能性とリスクを検証
```

## トラブルシューティング

### 思考が長すぎる場合

1. より具体的な質問に分割
2. 優先順位を明確にする
3. 出力形式を指定する

### 期待と異なる分析

1. 背景情報を追加提供
2. 分析の観点を明示
3. 具体例を提示

### リソース制限

1. 重要な部分のみに使用
2. 段階的に質問を分割
3. 通常モードとの使い分け

---

**関連ドキュメント:**
- [スラッシュコマンド](slash-commands.md) - /thinkコマンドの使い方
- [メモリ管理機能](memory-management.md) - コンテキスト情報の活用
- [高度なトピック](../10-advanced-topics.md) - 上級テクニック